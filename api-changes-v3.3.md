# Изменения API v3.3: Получение Сообщений с Пагинацией (Body + Query Params)

Этот документ описывает обновленный эндпоинт для получения сообщений чата с поддержкой пагинации.

## 1. Получение Списка Сообщений (Пагинация)

*   **Метод:** `GET`
*   **Путь:** `/messages`
    *   *Изменение:* Путь больше не содержит `:conversation_id`. ID чата теперь передается в теле запроса.
*   **Query Параметры:**
    *   `limit` (number, опционально, по умолчанию 50): Максимальное количество сообщений для возврата.
    *   `offset` (number, опционально, по умолчанию 0): Количество сообщений, которое нужно пропустить (для пагинации).
*   **Заголовки:** `Authorization: Bearer <your_token>`, `Content-Type: application/json`
    *   *Важно:* Необходимо указывать `Content-Type: application/json`, так как GET-запрос теперь содержит тело.
*   **Тело Запроса (JSON):**
    ```json
    {
      "conversation_id": "uuid-чата-для-загрузки-сообщений"
    }
    ```
*   **Ответ (Успех 200 OK):** Массив объектов сообщений, отсортированных по дате создания (сначала новые), с учетом `limit` и `offset`. Каждый объект содержит поля, описанные в v3.2 (включая поля пересылки).
    ```json
    [
      {
        "id": "uuid-сообщения-N",
        "conversation_id": "uuid-чата",
        "sender_id": "uuid-отправителя",
        "sender_username": "Имя-отправителя",
        "content": "Текст сообщения N",
        "created_at": "2023-10-27T12:00:00.000Z",
        "is_edited": false,
        "replied_to_message_id": null,
        "replied_to_sender_username": null,
        "replied_to_content_preview": null,
        "is_forwarded": false,
        "forwarded_from_user_id": null,
        "forwarded_from_username": null,
        "original_message_id": null,
        "read_by_users": [
          { "contact_id": "uuid-читателя", "username": "Имя-читателя", "email": "...", "read_at": "..." }
        ],
        "files": [],
        "is_read_by_current_user": true // Флаг, прочитано ли сообщение *текущим* пользователем
      },
      {
        // ... Сообщение N-1 ...
      }
      // ... до limit сообщений ...
    ]
    ```
*   **Ответ (Ошибка):** `400` (не указан `conversation_id` в теле), `401` (не авторизован), `403` (не участник чата), `500`.
*   **Примечание:**
    *   Запрос сообщений больше *не* помечает их автоматически как прочитанные. Клиент должен использовать событие `markMessagesAsRead` или аналогичный механизм.
    *   Использование тела в GET-запросах не является стандартным REST подходом и может вызвать проблемы с некоторыми инструментами или кэшированием. Реализовано согласно требованию. 