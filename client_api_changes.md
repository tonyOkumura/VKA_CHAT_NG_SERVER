# Изменения API для Клиента (Flutter)

Этот документ описывает необходимые изменения в клиентском коде (Flutter) для корректной работы с обновленным API сервера Node.js.

**Базовый URL API (предположительно):** `http://localhost:6000` (замените на ваш реальный базовый URL, если отличается).
**Префикс маршрутов задач (предположительно):** `/api/tasks` или `/tasks` (в примерах ниже используется `/tasks` как основа).

---

## 1. Задачи (Tasks)

### 1.1. Создание Задачи
- **Метод:** `POST`
- **Путь:** `/tasks/`
- **Тело запроса (JSON):**
  ```json
  {
    "title": "Название задачи (обязательно)",
    "description": "Описание задачи (опционально)",
    "status": "статус (опционально, default: 'open')",
    "priority": 1, // число (опционально, default: 3)
    "assignee_id": "UUID исполнителя (опционально, null если нет)",
    "due_date": "ISO 8601 строка даты срока (опционально, null если нет)"
  }
  ```
- **Действие клиента:** Убедитесь, что отправляется `POST` запрос с указанным телом.

### 1.2. Получение Списка Задач
- **Метод:** `GET`
- **Путь:** `/tasks/`
- **Параметры URL (Query Parameters):**
  - `status` (string, e.g., "open")
  - `search` (string)
  - *Примечание: Сервер может поддерживать и другие параметры фильтрации.*
- **Действие клиента:** `GET` запрос. Можно добавлять query-параметры (например, `/tasks/?status=open&search=текст`).

### 1.3. Получение Задачи по ID
- **Метод:** `POST`
- **Путь:** `/tasks/get`
- **Тело запроса (JSON):**
  ```json
  {
    "taskId": "UUID задачи (обязательно)"
  }
  ```
- **Действие клиента:** Отправлять `POST` запрос (не `GET /tasks/:id`). `taskId` должен быть в теле.

### 1.4. Обновление Задачи
- **Метод:** `PUT`
- **Путь:** `/tasks/update`
- **Тело запроса (JSON):**
  ```json
  {
    "taskId": "UUID задачи (обязательно)",
    // --- Обновляемые поля (хотя бы одно) ---
    "title": "Новое название",
    "description": "Новое описание",
    "status": "in_progress",
    "priority": 2,
    "assignee_id": "UUID нового исполнителя или null",
    "due_date": "ISO 8601 нового срока или null"
  }
  ```
- **Действие клиента:** Отправлять `PUT` запрос (не `PUT /tasks/:id`). `taskId` и обновляемые поля должны быть в теле.

### 1.5. Удаление Задачи
- **Метод:** `DELETE`
- **Путь:** `/tasks/delete`
- **Тело запроса (JSON):**
  ```json
  {
    "taskId": "UUID задачи (обязательно)"
  }
  ```
- **Действие клиента:** Отправлять `DELETE` запрос (не `DELETE /tasks/:id`). `taskId` должен быть в теле.

---

## 2. Комментарии к Задачам (Task Comments)

### 2.1. Добавление Комментария
- **Метод:** `POST`
- **Путь:** `/tasks/comments/add`
- **Тело запроса (JSON):**
  ```json
  {
    "taskId": "UUID задачи (обязательно)",
    "comment": "Текст комментария (обязательно)"
  }
  ```
- **Действие клиента:** Убедитесь, что отправляется `POST` запрос с указанным телом.

### 2.2. Получение Комментариев Задачи **(ИЗМЕНЕНО)**
- **Метод:** `POST`
- **Путь:** `/tasks/comments/get`
- **Тело запроса (JSON):**
  ```json
  {
    "taskId": "UUID задачи (обязательно)"
  }
  ```
- **Действие клиента:** Изменить запрос с `GET /tasks/:taskId/comments` на `POST /tasks/comments/get`. `taskId` должен быть в теле JSON.

---

## 3. Вложения к Задачам (Task Attachments)

### 3.1. Добавление Вложения
- **Метод:** `POST`
- **Путь:** `/tasks/attachments/add`
- **Тип запроса:** `multipart/form-data`
- **Тело запроса (Form Data):**
  - Поле `taskId`: UUID задачи (обязательно)
  - Поле `file`: Сам загружаемый файл (обязательно)
- **Действие клиента:** Отправлять `POST` запрос как `multipart/form-data` с полями `taskId` и `file`.

### 3.2. Получение Списка Вложений Задачи **(ИЗМЕНЕНО)**
- **Метод:** `POST`
- **Путь:** `/tasks/attachments/get`
- **Тело запроса (JSON):**
  ```json
  {
    "taskId": "UUID задачи (обязательно)"
  }
  ```
- **Действие клиента:** Изменить запрос с `GET /tasks/:taskId/attachments` на `POST /tasks/attachments/get`. `taskId` должен быть в теле JSON.

### 3.3. Скачивание Вложения
- **Метод:** `GET`
- **Путь:** `/tasks/attachments/:attachmentId/download`
  - `:attachmentId` - это ID самого вложения.
- **Тело запроса:** Нет.
- **Действие клиента:** `GET` запрос, `attachmentId` в пути. Серверная логика проверки прав улучшена.

### 3.4. Удаление Вложения
- **Метод:** `DELETE`
- **Путь:** `/tasks/attachments/:attachmentId/delete`
  - `:attachmentId` - это ID самого вложения.
- **Тело запроса:** Нет.
- **Действие клиента:** `DELETE` запрос, `attachmentId` в пути.

---

## 4. Логи Изменений Задач (Task Logs)

### 4.1. Получение Логов Задачи
- **Метод:** `POST`
- **Путь:** `/tasks/logs/get`
- **Тело запроса (JSON):**
  ```json
  {
    "taskId": "UUID задачи (обязательно)"
  }
  ```
- **Действие клиента:** (Предположительно, уже работает корректно) `POST` запрос с `taskId` в теле.

---

## 5. Отчеты по Задачам (Task Reports)

### 5.1. Генерация Отчета
- **Метод:** `GET`
- **Путь:** `/tasks/report`
- **Параметры URL (Query Parameters):** Множество опциональных параметров, таких как:
  - `startDate`, `endDate`
  - `status` (через запятую, e.g., "open,in_progress")
  - `priority` (через запятую, e.g., "1,2")
  - `assigneeId` (UUID, "me", "null")
  - `creatorId` (UUID, "me")
  - `dueDateStart`, `dueDateEnd`
  - `dueDateFilter` ("null", "notnull")
  - `updatedBeforeDays` (число)
- **Действие клиента:** `GET` запрос. Можно добавлять любые из поддерживаемых query-параметров.

---

**Важно:**
- Всегда проверяйте статусы ответов от сервера и обрабатывайте возможные ошибки.
- Убедитесь, что заголовки аутентификации (JWT токен) отправляются со всеми запросами, как это требует ваш `verifyToken` middleware на сервере.
- Адаптируйте пути запросов, если ваш глобальный префикс API отличается от `/tasks` (например, `/api/tasks`). 